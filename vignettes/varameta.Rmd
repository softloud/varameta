---
title: "varameta"
output: 
  rmarkdown::html_vignette:
    number_sections: true
vignette: >
  %\VignetteIndexEntry{varmeta}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
set.seed(39)
library(varameta)
library(tidyverse)

sample_size <- 10

```

# objective

The `varameta::` package aims to bridge the toolchain gap from a dataset containing medians to a software package, such as `metafor::`, for meta-analysis.

# quick and dirty

# calculate standard error of mean or median based on effect, spread, and sample size

A wrapper function `effect_se` provides a quick method of calculating the error of an effect based on its measure of effect, spread, sample size. 

Consider a randomly generated sample.

```{r sample}
(a_sample <- rlnorm(sample_size,-1, 0.1))

# summary statistics for this sample
a_sample %>% log() %>% summary()
```

Taken from a lognormal distribution $\mathrm{lognormal}(-1, 0.1^2)$. 

```{r plot, echo=FALSE, fig.align='center', fig.width=6}

# taken from lognormal distribution
tibble(x = c(0, 1)) %>%
  ggplot(aes(x = x)) +
  geom_density(
    data = tibble(x = a_sample),
    aes(x = x),
    alpha = 0.5,
    fill = "darkgrey",
    colour = "darkgrey"
  ) +
  stat_function(
    fun = dlnorm,
    args = list(meanlog = -1,
                sdlog = 0.1),
    linetype = "dotted"
  ) + 
  labs(title = stringr::str_wrap("Sample from log-normal density", 30),
       subtitle = stringr::str_wrap("Sample density in grey fill; true density, black dotted line"),
       caption = "lognormal(-1, 0.01)")



```

```{r}


# calculate the standard error based on the median, interquartile range, and
# sample size

effect_se(
  centre = median(a_sample),
  spread = IQR(a_sample),
  n = length(a_sample),
  centre_type = "median",
  spread_type = "iqr"
)


```


## standard error of the sample median



# variance of the sample median

- explicit example
- then with sampling


# vectorised calculations

## standard error of the sample mean

```{r}
# take a sample
se_mean_eg_sample <- rexp(sample_size)

```

Now, we wish to calculate the standard error $s/\sqrt n$ of the sample mean, calcualted with the the sample standard deviation and the squared-root of the sample size.


```{r}

# mean and sd
effect_se(
  centre = mean(se_mean_eg_sample),
  spread = sd(se_mean_eg_sample),
  n = length(se_mean_eg_sample),
  centre_type = "mean",
  spread_type = "sd"
)

# compare
sd(se_mean_eg_sample) /
  sqrt(length(se_mean_eg_sample))

# mean and var
effect_se(
  centre = mean(se_mean_eg_sample),
  spread = var(se_mean_eg_sample),
  n = length(se_mean_eg_sample),
  centre_type = "mean",
  spread_type = "var"
)

# compare
sqrt(var(se_mean_eg_sample) /
  length(se_mean_eg_sample))


```





# other estimators

All other estimators available for meta-analysis are provided in `varameta::` for use in a compative analysis. 
